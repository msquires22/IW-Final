<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Change Password - College Athlete Connect</title>
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <header>
        <div id="navbar-placeholder"></div>
    </header>
    <script>
        fetch('navbar.html')
            .then(response => response.text())
            .then(text => document.getElementById('navbar-placeholder').innerHTML = text);
    </script>
    <div id="main-content-pass">
        <main id="change-password-container">
            <h2>Change Password</h2>
            <form id="change-password-form">
                <input type="password" id="current-password" placeholder="Current Password" required>
                <input type="password" id="new-password" placeholder="New Password" required>
                <input type="password" id="confirm-new-password" placeholder="Confirm New Password" required>
                <button type="submit">Update Password</button>
            </form>
            <div id="change-password-message"></div>
        </main>
    </div>
    <footer>
        <p> 2024 College Athlete Connect</p>
    </footer>

    <script type="module">
        import { auth } from './firebaseconfig.js';
        import { reauthenticateWithCredential, EmailAuthProvider, updatePassword } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';

        document.getElementById('change-password-form').addEventListener('submit', async (e) => {
            e.preventDefault();

            const currentPassword = document.getElementById('current-password').value;
            const newPassword = document.getElementById('new-password').value;
            const confirmPassword = document.getElementById('confirm-new-password').value;
            const messageElement = document.getElementById('change-password-message');

            messageElement.textContent = '';

            // Check if the new passwords match
            if (newPassword !== confirmPassword) {
                messageElement.textContent = 'The new passwords do not match.';
                messageElement.style.color = 'red';
                return;
            }

            const user = auth.currentUser;
            if (!user) {
                messageElement.textContent = 'No user is currently signed in.';
                messageElement.style.color = 'red';
                return;
            }

            // Proceed with re-authentication
            const credential = EmailAuthProvider.credential(user.email, currentPassword);
            try {
                await reauthenticateWithCredential(user, credential);
            } catch (error) {
                messageElement.textContent = 'The current password is incorrect.';
                messageElement.style.color = 'red';
                return;
            }

            // Update password
            try {
                await updatePassword(user, newPassword);
                messageElement.textContent = 'Password updated successfully.';
                messageElement.style.color = 'green';
                // Redirect or notify of success as needed
                window.location.href = 'Profile.html?passwordChange=success';
            } catch (error) {
                messageElement.textContent = `Error updating password: ${error.message}`;
                messageElement.style.color = 'red';
            }
        });
    </script>
</body>

</html>

<!-- The above code was created with assitance from Chat GPT-->